/* Copyright 2008 FriendFeed */

var HINT_COLOR="silver";function curry(C){var A=[];for(var B=1;B<arguments.length;B++){A.push(arguments[B])}return function(){var D=[];for(var E=0;E<A.length;E++){D.push(A[E])}for(var E=0;E<arguments.length;E++){D.push(arguments[E])}return C.apply(null,D)}}function bind(A,B){if(typeof (B)=="string"){B=A[B]}return function(){return B.apply(A,arguments)}}function checkRequired(D,B){var E=true;for(var C=0;C<B.length;C++){var A=D[B[C]];if(!A){continue}if(!A.value||A.style.color==HINT_COLOR){A.style.backgroundColor="#ffffcc";if(E){A.focus()}E=false}else{A.style.backgroundColor="white"}}return E}function showInputHint(A,B){A.focus(curry(inputHintFocus,A,B));A.blur(curry(inputHintBlur,A,B));inputHintBlur(A,B)}function inputHintFocus(A,B){if(A.css("color")==HINT_COLOR){A.val("");A.css("color","")}}function inputHintBlur(A,B){if(!A.val()||A.val()==B){A.css("color",HINT_COLOR);window.setTimeout(function(){A.val(B)},0)}}function windowSize(){var C=document.documentElement;var A=window.innerWidth||self.innerWidth||(C&&C.clientWidth)||document.body.clientWidth;var B=window.innerHeight||self.innerHeight||(C&&C.clientHeight)||document.body.clientHeight;return{width:A,height:B}}function scrollPos(){if(self.pageYOffset!==undefined){return{x:self.pageXOffset,y:self.pageYOffset}}var A=document.documentElement;return{x:A.scrollLeft,y:A.scrollTop}}jQuery.fn.center=function(G,A){var B=windowSize();var E=scrollPos();for(var D=0;D<this.length;D++){var F=Math.max(0,B.width-this[D].offsetWidth);var C=Math.max(0,B.height-this[D].offsetHeight);$(this[D]).css({top:E.y+C*(A!==undefined?A:0.5),left:E.x+F*(G!==undefined?G:0.5)})}return this};function recenterDialog(B){var A=$("#dialog-background");if(!A.length){return }A.center(0,0);if(B){$(".dialog").css(B)}else{$(".dialog").center()}}$(function(){if(!window.gIsIphone){$(document).scroll(function(){recenterDialog()})}if($("#subtabs").length){function A(){var B=$("#subtabs div.l_tab");$("#subtabs")[(B.length>1&&B[0].offsetTop<B[B.length-1].offsetTop)?"addClass":"removeClass"]("bubbletabs")}A();$(window).resize(A)}});jQuery.dialog=function(A,B){$.closeDialog();$("body").append('<div id="dialog-background"></div>'+A);recenterDialog(B);$("#dialog-background").click($.closeDialog)};jQuery.closeDialog=function(){$(".dialog, #dialog-background").remove()};jQuery.fn.setOrRemoveAttr=function(A,B){if(!B){this.removeAttr(A)}else{this.attr(A,B)}return this};jQuery.fn.setChecked=function(A){return this.setOrRemoveAttr("checked",A)};jQuery.fn.setDisabled=function(A){return this.setOrRemoveAttr("disabled",A)};function getCookie(A){var B=document.cookie.match("\\b"+A+"=([^;]*)\\b");return B?B[1]:undefined}var loadingImg='<img src="/static/images/loading.gif?v=1" class="loading"/>';function showLoading(A){A.append(loadingImg)}function removeLoading(){$("img.loading").remove()}jQuery.fn.serializeObj=function(){var C={},A=this.serializeArray();for(var B in A){var D=A[B];C[D.name]=D.value}return C};jQuery.postJSONLoading=function(A,B,C,D){jQuery.postJSON(B,C,D,A)};jQuery.postJSON=function(url,data,callback,loadingNode){if(loadingNode){showLoading(loadingNode)}data.at=getCookie("AT");var body=$.param(data);if(window.facebookParams&&url.charAt(0)=="/"){body+="&"+facebookParams}$.ajax({url:url,data:body,dataType:"text",type:"POST",success:function(data){if(loadingNode){removeLoading()}if(callback){callback(eval("("+data+")"))}}})};function removeMessages(){$(".infomessage, .errormessage").remove()}function infoMessage(A){removeMessages();if(A){$("#body").prepend($('<div class="infomessage">'+A+"</div>"))}}function errorMessage(A){removeMessages();if(A){$("#body").prepend($('<div class="errormessage">'+A+"</div>"))}}function isFriendFeed(A){return A.charAt(0)=="/"||A.match(/^https?:\/\/friendfeed.com(:8889)?\//)}function addFBParams(A){if(!window.facebookParams||!isFriendFeed(A)){return A}return A+(A.indexOf("?")!=-1?"&":"?")+facebookParams}var htmlCharMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function htmlCharEsc(A){return htmlCharMap[A]}function htmlEscape(A){return String(A).replace(/[&<>\"]/g,htmlCharEsc)}function tag(F,A,D,E){if(typeof (A)=="string"){A={id:A}}var C="<"+F;for(var B in A){if(A[B]!=undefined){C+=" "+htmlEscape(B)+'="'+htmlEscape(A[B])+'"'}}C+=">";if(D!=undefined){C+=D+"</"+F+">"}if(E){E[E.length]=C}return C}function tagc(D,A,B,C){return tag(D,{"class":A},B,C)}function donothing(){}window.dtimer=function(){return donothing};window.dprint=donothing;String.prototype.startsWith=function(A){return this.substring(0,A.length)==A};String.prototype.endsWith=function(A){return this.length>=A.length&&this.substring(this.length-A.length)==A};var gEditCommentLink='<span class="editcomment">&nbsp;(<a href="#" class="l_editcomment">edit</a>&nbsp;|&nbsp;<a href="#" class="l_deletecomment">delete</a>)</span>';function playVideo(C){var A=C.parents(".container");var D=A.find(".playdiv :first-child")[0];A.parents(".media").find(".player").remove();if(A.attr("playing")){setPngSrc(D,"/static/images/playbutton.png?v=1");A.removeAttr("playing")}else{setPngSrc(D,"/static/images/stopbutton.png?v=1");A.attr("playing",true);var B=A.find("a").attr("play");A.parents(".media").append('<div class="player">'+B+"</div>")}return false}function addPlayButtons(A){if(window.gIsIphone){return }var C=29;var B=29;A.find("a.l_play").each(function(){var F=$(this).find("img");var D=$('<div class="l_play playdiv"/>');D.css("left",Math.round((F[0].width/2)-(C/2)+4)+"px");D.css("top",Math.round((F[0].height/2)-(B/2)+4)+"px");var E=createPngImage("/static/images/playbutton.png?v=1",C,B);E.style.border="0";E.style.padding="0";D.append(E);$(this).parent().append(D)})}function installFBApp(B){var A="http://apps.facebook.com"+gFacebookPath+document.location.pathname;if(B){A+="?fbcomment="+B}top.location="http://"+gFacebookServer+"/connect?next="+encodeURIComponent(A)+"&src="+(B?"fbcom":"fblike")}function listToSet(B){var C={};for(var A=0;A<B.length;++A){C[B[A]]=1}return C}var gIsPermaLink=document.location.pathname.substring(0,3)=="/e/";var gInFb=document.location.search.match("fb_sig_in_iframe=1");var gNeedsFbApp=gInFb&&!document.location.search.match("fb_sig_had_user=1");var gInGadget=document.location.pathname=="/embed/googlegadget";function createInfoLinks(B,A){var G=A.parentNode;var E=listToSet(G.className.split(" "));var C="";C+=' - <a href="#" class="l_comment">Comment</a>';if(E.other){var D=E.liked?'style="display:none" ':"";C+="<span "+D+'class="like">&nbsp;- <a href="#" class="l_like">Like</a></span>'}if(!gInGadget){var F=G.getAttribute("tohide");if(F){if(E.hidden){C+=" - "+hideRuleLink(F,"Unhide")}else{C+=' - <a href="#" class="l_hide">Hide</a>'}}if(!gIsPermaLink){C+=' - <a href="#" class="l_options">More</a>'}}A.innerHTML+=C}function addExtraLinks(B,C){var A=dtimer("addExtraLinks");if(C){setTimeout(function(){addPlayButtons(B)},300)}else{addPlayButtons(B);A("addPlayButtons")}if(!gUserLink&&!gInFb){return }$(B).find("div.info").each(createInfoLinks);A("createInfoLinks");$(B).find("div.comment.owner").append(gEditCommentLink);A("createCommentLinks")}function updateLikes(C,A){if(A.html){function D(){C.find(".likes").remove();C.find(".comments").before('<div class="likes">'+A.html+"</div>")}var B=C.find(".likes");if(B.length>0){B.hide(100,D)}else{D()}}else{C.find(".likes").hide(100)}}function nonUserSubscribe(A,B){document.cookie="SUB="+A+"; path=/";document.location="/account/login?next="+encodeURIComponent(B);return false}function hideRuleLink(A,B){return tag("a",{href:"#",rule:A,"class":"l l_sethiderule"},B)}function hideLikeThis(K){var L=K.parents(".entry");var D=getEntryInfo(L);var I=L.attr("tohide");var G=D.cluster.find("div.icon img.icon").attr("alt");var F='<div class="hideentoptions">',A={},J=0;function C(O,P,N){if(!N){N={}}if(!N.type){N.type="radio"}if(N.type=="radio"){N.name="rule"}else{N["class"]="cb"}N.rule=O;N.optnum=J++;N.id="opt_"+N.optnum;return tag("label",{"for":N.id},tag("input",N,P))}if(D.fof.length){F+=C(I,"Hide all "+D.fof.html()+"'s "+G+" entries",{checked:true});F+=C(I.split("_")[0]+"_all_2","Hide all stuff from "+D.fof.html());F+=C(D.cluster.attr("friendid")+"_fof_2","Hide all stuff from "+D.friend.html()+"'s friends");F+=C("all_fof_2","Hide all stuff from friends-of-friends")}else{var M=D.friend.is(".you")?"your":(D.friend.html()+"'s");F+=C(I.replace(/_.$/,"_1"),"Hide all "+M+" "+G+" entries",{checked:true});F+=C(I.replace(/_.$/,"_2"),"even if they have comments or likes",{type:"checkbox",checked:(I.match(/_2$/)?"true":undefined)})}var H=I.split("_")[1];F+=C("all_"+H+"_1","Hide everyone's "+G+" entries");F+=C("all_"+H+"_2","even if they have comments or likes",{type:"checkbox"});if(D.friend.is(".you")){var B=I.split("_")[0];F+=C(B+"_all_1","Hide all entries from you");F+=C(B+"_all_2","even if they have comments or likes",{type:"checkbox"})}F+='<button>Hide entries</button></div><a href="#" class="close l l_closedialog">Cancel</a>';$.dialog('<div class="dialog hideent"><div class="title">Hide Entries</div><div class="content">Hidden stuff will no longer appear in your Friends Feed, however you can still find them by clicking on the "View hidden entries" link at the bottom of the page. To stop hiding something, click "Unhide" on the hidden entry.'+F+"</div></div>",(document.location.pathname.startsWith("/embed/")||gInFb?undefined:K.offset()));function E(){$(".hideentoptions input:checkbox").each(function(){var N=$(this).attr("optnum");if($("#opt_"+(N-1)).attr("checked")){$(this).setDisabled(false).parent().removeClass("disabled")}else{$(this).setDisabled(true).parent().addClass("disabled")}})}E();$(".hideentoptions input[type=radio]").click(E);$(".hideentoptions button").click(function(){var N=$(".hideentoptions input:radio[checked]").attr("optnum");if($("input:checkbox[checked]#opt_"+(+N+1)).length){N++}setHideRules($(this).parent(),$("#opt_"+N).attr("rule"))}).focus()}function setHideRules(A,C,B){var D=C.split(" ")[0];$.postJSONLoading(A,"/events/sethiderule",{rules:C},function(H){var I=D.split("_");if(I[2]==0||I[0]=="all"||I[1]=="all"||B){if(I[1]=="e"){var G=$("#e-"+I[0]),K=G.attr("oldhtml");if(K){return G.html(K)}}setLocationParam("oldhr",H.oldrules)}else{dprint(H.oldrules);var F,J="";if(I[1]=="e"){F=$("#e-"+I[0]);F.attr("oldhtml",F.html());J=' - <a href="#" class="l_hidelike">See options for hiding other items like this</a>'}else{var E=$("div[tohide="+D+"]");if(I[2]==2){E=E.add("div[tohide="+D.replace(/2$/,"1")+"]")}if(I[1]=="fof"){E=E.add("div[friendid="+I[0]+"] .entry")}F=E.parents("div.cluster")}removeMessages();F.html('<div class="didhide"><div>Entry hidden - '+hideRuleLink(H.oldrules,"Undo")+J+'</div>Hidden entries can be found in "show hidden items" at the bottom of the page</div>');$(".hidetoggle, .hiddenent").remove();$(".feed").append('<div class="hidetoggle"><a class="l l_reload" href="#">Refresh</a> to view hidden entries</div>');$.closeDialog()}})}function closePopupMenu(){$(".popupmenu").remove()}function setPopupMenu(B,E){var A=$(".popupmenu");if(A.length&&A[0].menulink==E){closePopupMenu();return }closePopupMenu();var F=$('<div class="popupmenu">');var H=$('<div class="shadow">');var C=$('<div class="foreground">');F.append(H);F.append(C);F[0].menulink=E;$.each(B,function(K,L){var J=$.extend({href:"#"},L.attrs||{});var I=$(tag("a",J,L.l));if(L.onclick){I.click(function(M){L.onclick(M);closePopupMenu();return false})}C.append(I)});if(!B.length){C.append("No options :(")}$("body").append(F);var G=$(E).offset();G.top+=$(E).height()+2;F.css(G);var D=2;H.width(C.width()+D);H.height(C.height()+D)}function createPngImage(D,C,A){if(navigator.userAgent.indexOf("MSIE")!=-1){var B=document.createElement("div");B.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+D+"')"}else{var B=document.createElement("img");B.src=D}B.style.width=C+"px";B.style.height=A+"px";return B}function setPngSrc(A,B){if(navigator.userAgent.indexOf("MSIE")!=-1){A.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+B+"')"}else{A.src=B}}function setLocationParam(A,B){var C={};C[A]=B;location.href=addFBParams(location.pathname+"?"+$.param(C))}function entryId(A){return A.attr("id").substring(2)}function getEntryInfo(C){var A=C.parents(".cluster"),D=A.find(".summary .nonf"),B=A.find(".summary .friend").not(".nonf");if(!B.length&&D.length){B=D;D=$("#nothingelem")}return{entry:C,entryClass:listToSet(C[0].className.split(" ")),cluster:A,fof:D,friend:B}}function setMute(A,B){$.postJSONLoading(A,"/events/setmute",{entry:entryId(A),value:B},function(C){if(B){A.find(".comments").hide().addClass("muted")}else{A.find(".commentexpander, .unmute").hide();A.find(".comments, .hiddencomments").show().removeClass("muted")}})}function makeMultiLine(A){A.removeClass("singleline").css("height","6em");if(window.updateFrameSize){window.updateFrameSize()}}function instrumentCommentBox(C,A){function D(){var E=C[0];if(C.is(".singleline")&&(E.value.indexOf("\n")!=-1||E.scrollTop||E.scrollLeft||E.scrollHeight>E.offsetHeight)){makeMultiLine(C)}}C.css("margin-bottom",($.browser.safari?"-5px":($.browser.mozilla?"-3px":"0"))).css("height",$.browser.msie?"1.25em":"1.15em").css("line-height",$.browser.msie?"1.1em":"1em").keypress(function(G){var E=C.parents("form");var F=E.find("input[type=submit]");if(G.keyCode==9){F.focus();return false}if(G.keyCode==13){if(!F.attr("disabled")){E.submit()}return false}D();if(this.value.length>=A&&G.charCode>8&&G.charCode<63200){return false}});var B=setInterval(function(){if(C.parents(".entry, #sharediv").length){D()}else{clearInterval(B)}},100)}function makeCommentForm(C,D){var B=$('<form action="/" method="post"/>');var A=$('<textarea class="singleline" name="comment"/>');instrumentCommentBox(A,D.prev(".comment").length?512:1024);if(C){makeMultiLine(A);A.val(C)}B.append(A);B.append('<input style="margin-left:3px" type="submit" value="Post"/>');return B}function now(){return(new Date()).getTime()}var autoRefresher={lastActive:now(),lastRefresh:now(),activity:function(){autoRefresher.lastActive=now()},start:function(A){this.refreshInterval=A;$(document).keypress(this.activity).mousemove(this.activity).mousedown(this.activity).scroll(this.activity);setInterval(bind(this,"maybeRefresh"),500)},isSafeToRefresh:function(){if(this.lastActive>now()-120000){return false}if($("object").length||$("textarea[name=comment]").length||shareDialogVisible()){this.activity();return false}return true},refreshId:0,lastMaybe:0,maybeRefresh:function(){if(this.lastMaybe<now()-1000){this.activity()}this.lastMaybe=now();if(this.lastRefresh>now()-this.refreshInterval||!this.isSafeToRefresh()){return }dprint("autorefreshing");this.lastRefresh=now();var B=++this.refreshId;var A=$.extend({feed_hash:window.gFeedHash},window.gFeedArgs);$.postJSON("/events/feed?auto=1",A,bind(this,function(C){if(!C||!this.isSafeToRefresh()){return }if(C.reload){document.location.reload()}else{if(C.feed_html&&this.refreshId==B){dprint("updating "+C.feed_hash);addExtraLinks($("#feedcontainer .feed").html(C.feed_html));window.gFeedHash=C.feed_hash}}}))}};function pageLoadId(){return(new Date(document.lastModified)).getTime()}function maybeRestoreHtml(){var A=$("input.savedhtml").val();var C=$("input.savedhash").val();if(C){dprint("Saved hash "+C)}if(A&&C&&$("input.savedloadid").val()==pageLoadId()){var B=dtimer();$("#feedcontainer").html(A);window.gFeedHash=C;B("restore html");return true}}function savePageHtml(){var A=dtimer();$("input.savedhtml").val($("#feedcontainer").html());$("input.savedhash").val(window.gFeedHash);$("input.savedloadid").val(pageLoadId());A("save html")}$(function(){var B=["click","mouseover","mouseout"];for(var A=0;A<B.length;A++){bindEvents(B[A])}$("body").mousedown(function(D){for(var C=D.target;C;C=C.parentNode){if(C.tagName=="A"){if(C.className.match(/l_/)||(document.location.href.split("#")[0]+"#")==C.href){return }if(window.gNewWin&&C.href.indexOf("//"+document.location.host+"/")==-1){C.target="_blank"}savePageHtml();return }}})});function bindEvents(A,B){$("body")[A](function(D){for(var C=D.target;C;C=C.parentNode){if(tryEventHandler(C,A)){return A=="click"?false:undefined}}if(A=="click"){userpopup.hide();closePopupMenu()}})}function tryEventHandler(D,B){if(!D.className){return }var A=D.className.match(/\bl_([\w]+)\b/);if(!A){return }var C=window[B+"Handlers"][A[1]];if(!C){return }C($(D));return true}function deleteEntry(E){var B=E.parents(".cluster");var D=B.attr("id");var F=B.attr("streamid");if(D){D=D.substring(2)}else{D=""}$.postJSON("/events/delete",{cluster:D,streamid:F,entry:entryId(E),"delete":"1"});var A=$('<div class="deleted"><i>Entry deleted</i> - </div>');var C=$('<a href="#" class="f">Undo</a>');A.append(C);A.insertAfter(E);E.hide(100);C.click(function(){$.postJSON("/events/delete",{cluster:D,entry:entryId(E),"delete":"0"});A.remove();E.show(100);return false})}function moderateComments(A){A.find(".comments .comment").find(".moderate").remove();A.find(".comments .comment").not(".owner").not(".deleted").append('<span class="moderate">&nbsp;(<a href="#" class="l_deletecomment">delete</a>)</span>')}function setTweetBackHtml(B){var C='<label for="twitback"><input type="checkbox" id="twitback">Also send this comment as an @reply twitter';if(gTwitLogin){C+=" from "+gTwitLogin+'</label> - <a href="#" class="l_twitlogin">change user</a>'}else{C+="</label>"}var A=$(".twitbox").html(C).find("input[type=checkbox]");A.click(function(){if(!gTwitLogin){doTwitLogin();return false}});if(B){if(gTwitLogin){A.attr("checked","true")}else{A.removeAttr("checked")}}}function doTwitLogin(){$.dialog('<div class="dialog twitterlogin" style="width:30.5em"><div class="title"><img src="/static/images/icons/twitter.png?v=1">Twitter Login</div><div style="background:white"><iframe style="width:30em;height:'+(gTwitLogin?"16.5":"13.5")+'em;border-width:0px" src="'+gHttpsPrefix+'/account/twitterlogin"></iframe></div></div>')}function setTwitLogin(A){gTwitLogin=A;setTweetBackHtml(true);$(".comment textarea").focus()}function hidePromoUrl(B,A){return"/settings/hidepromo?id="+B+"&next="+encodeURIComponent(A)}function highlightText(B,C){if(!C){return }dprint("elems: "+B);var A=new RegExp("\\b"+C.replace("\\","\\\\")+"\\b","gi");B.each(function(D,E){highlightNode(E,C,A)})}function makeLoadingNode(A){return $('<span style="position:absolute;padding-left:4px;z-index:2000"/>').appendTo(A)}function highlightNode(D,J,M){if(D.nodeType==3){var K=D.nodeValue;if(K.length<J.length){return }var H=[];M.lastIndex=0;while(true){var N=M.exec(K);if(!N){break}H.push(N.index)}if(H.length==0){return }var E=[];var L=0;var C=document.createElement("span");for(var F=0;F<H.length;F++){var B=K.substr(L,H[F]-L);C.appendChild(document.createTextNode(B));var I=document.createElement("span");I.style.fontWeight="bold";I.style.color="#222222";I.appendChild(document.createTextNode(K.substr(H[F],J.length)));C.appendChild(I);L=H[F]+J.length}if(L<K.length){var B=K.substr(L);C.appendChild(document.createTextNode(B))}D.parentNode.insertBefore(C,D);D.parentNode.removeChild(D);return }if(D.nodeType!=1||D.className.indexOf("editcomment")!=-1||D.className.indexOf("highlighted")!=-1){return }for(var A=D.firstChild;A!=null;){var G=A.nextSibling;highlightNode(A,J,M);A=G}}var clickHandlers={comment:function(G){var H=G.parents(".entry");if(gNeedsFbApp){installFBApp(entryId(H));return }if(H.find(".muted").length){clickHandlers.showcomments(H.find(".l_showcomments"))}var J=G.parents(".cluster");var D=$("#cf-"+entryId(H));function E(){D.remove()}if(D.length>0){if(!D.find("textarea").val()){E()}return }D=$('<div class="comment"/>').attr("id","cf-"+entryId(H));D.hide();H.find(".comments").append(D).show();var A=makeCommentForm("",D);D.append(A);if(H.is(".twitter")){A.append('<div class="twitbox"></div>');setTweetBackHtml()}var I=$("<div></div>").hide().appendTo(A);if(window.Recaptcha){Recaptcha.destroy()}function B(K){if(window.Recaptcha){window.setTimeout(K,0)}else{$.getScript("http://api.recaptcha.net/js/recaptcha_ajax.js",K)}}function C(K,L){B(function(){if(Recaptcha.widget){Recaptcha.reload();var M=$("#recaptcha_instructions_image");M.css("color","#cc0000");M.text("Incorrect. Try again:");if(L){L()}}else{Recaptcha.create(K.captcha,$('<div id="captcha"/>').appendTo(I).get(0),{theme:"white",callback:function(){I.show(100,function(){if(L){L()}Recaptcha.focus_response_field()})}})}})}function F(K,L){if(window.Recaptcha){Recaptcha.destroy()}$('<div class="comment" id="cmt-'+K.id+'">'+K.body_html+" - "+gUserLink+gEditCommentLink+"</div>").hide().appendTo(H.find(".comments")).show();D.remove();L()}A.submit(function(){var M=A.find("textarea").val();if(!M){E();return false}var L=A.find(".twitbox input[type=checkbox]").attr("checked");removeLoading();A.find("input[type=submit]").attr("disabled","true").after(loadingImg);function K(){A.find("input[type=submit]").removeAttr("disabled");removeLoading()}$.postJSON("/events/comment",$.extend({entry:entryId(H),streamid:J.attr("streamid"),tweet:!!L,body:M},window.Recaptcha&&Recaptcha.widget?{recaptcha_challenge_field:Recaptcha.get_challenge(),recaptcha_response_field:Recaptcha.get_response()}:{}),function(N){if(N.captcha){C(N,K)}else{F(N,K)}});return false});D.show();A.find("textarea").focus()},like:function(C){if(gNeedsFbApp){installFBApp();return }var B=C.parents(".entry");var A=C.parents(".cluster");C.parents("span.like").hide();$.postJSON("/events/like",{entry:entryId(B),streamid:A.attr("streamid")},curry(updateLikes,B))},unlike:function(C){var B=C.parents(".entry");var A=C.parents(".cluster");$(B).find("span.unlike").hide();$.postJSON("/events/deletelike",{entry:entryId(B),streamid:A.attr("streamid")},function(D){updateLikes(B,D);$(B).find("span.like").show()});return false},more:function(D){var A=D.parents(".cluster");var C=D.parent(".more");C.html('<img src="http://friendfeed.com/static/images/loading.gif?v=1"/>');var B=$.extend({cluster_entry_id:A.attr("eid")},gFeedArgs);$.postJSON("/events/feed",B,function(E){if(E&&E.feed_html){var F=$(E.feed_html);A.replaceWith(F);addExtraLinks(F)}})},thumbexpand:function(C){var B=C.parents(".entry");var A=C.parent(".more");A.html('<img src="http://friendfeed.com/static/images/loading.gif?v=1"/>');$.postJSON("/events/expand",{id:B.attr("id").substr(2)},function(D){if(D&&D.entry_html){var E=$(D.entry_html);B.replaceWith(E);addExtraLinks(E)}})},options:function(B){var A=B.parents(".entry");var C=getEntryInfo(A);var D=[];D.push({l:"Link to this entry",attrs:{"class":"noframe",target:"_top",href:"/e/"+entryId(A)}});if(document.location.pathname!="/public"){if(C.fof.length){D.push({l:"Subscribe to "+C.fof.html(),attrs:{"class":"l_subscribe",userid:C.cluster.attr("userid")}})}else{if(C.friend.length&&!C.friend.is(".you")){D.push({l:"Unsubscribe from "+C.friend.html(),attrs:{"class":"l_unsubscribe",userid:C.cluster.attr("userid")}})}}}if(C.entryClass.owner&&A.find(".comments .comment").not(".deleted").not(".owner").length){D.push({l:"Moderate comments",onclick:function(){moderateComments(A)}})}if(C.entryClass.owner){D.push({l:"Delete this entry",onclick:function(){deleteEntry(A)}})}setPopupMenu(D,B[0])},togglehide:function(){var A=$(".hiddenent");var B=A.css("display")=="none";A.css("display",B?"block":"none");$(".hidetoggle a span").html(B?"Hide":"Show");if(B){addPlayButtons(A,true)}},showcomments:function(A){A.parents(".commentexpander").hide();A.parents(".comments").show().find(".hiddencomments").show(100)},editcomment:function(E){var D=E.parents(".entry");var A=D.parents(".cluster");var F=E.parents(".comment");var C=F.attr("id").substring(4);var B=F.html();E.parents(".editcomment").remove();$.postJSONLoading(F,"/events/getcomment",{comment:C,entry:entryId(D)},function(G){var H=makeCommentForm(G.body_raw_html,F);F.empty();F.append(H);H.find("textarea").focus();H.submit(function(){var I=H.find("textarea").val();if(!I){clickHandlers.deletecomment(H,B);return false}H.find("input[type=submit]").attr("disabled","true");$.postJSONLoading(H,"/events/editcomment",{comment:C,entry:entryId(D),streamid:A.attr("streamid"),body:I},function(J){F.html(J.body_html+" - "+gUserLink+gEditCommentLink)});return false})})},deletecomment:function(F,B){var E=F.parents(".entry");var A=E.parents(".cluster");var G=F.parents(".comment");var D=G.attr("id").substring(4);var C=B||G.html();G.hide(100,function(){var H=$('<a href="#" class="undo">undo</a>');G.html("<i>Comment deleted</i> (");G.append(H);G.append(")");H.click(function(){G.hide(100,function(){G.html(C);G.show(100)});$.postJSON("/events/deletecomment",{comment:D,entry:entryId(E),streamid:A.attr("streamid"),"delete":"0"});return false});G.show(100)});$.postJSON("/events/deletecomment",{comment:D,entry:entryId(E),streamid:A.attr("streamid"),"delete":"1"})},unmute:function(A){setMute(A.parents(".entry"),0)},subscribe:function(B){var A=B.attr("userid");$.postJSONLoading(B,"/settings/subscribe",{id:A,format:"json"},function(C){if(C.verb){setLocationParam(C.verb,A)}})},unsubscribe:function(B){var A=B.attr("userid");$.postJSONLoading(B,"/settings/unsubscribe",{id:A},function(C){setLocationParam("unsub",A)})},sethiderule:function(A){var B=A.attr("rule");setHideRules(makeLoadingNode(A.parent()),B,true)},hidelike:function(A){hideLikeThis(A)},hide:function(A){setHideRules(makeLoadingNode(A.parent()),entryId(A.parents(".entry"))+"_e_2")},reload:function(){document.location.reload()},play:function(A){playVideo(A)},closedialog:function(){$.closeDialog()},tab:function(B){var A=$(B).find("a").attr("href");if(A){window.location=addFBParams(A)}},twitlogin:function(){doTwitLogin()},closepromo:function(){var A=$("#settingspromo").attr("promoid");$("#settingspromo").slideUp(200);$.postJSON("/settings/hidepromo",{id:A})}};function tryLinkClick(C){if(!C.className){return }var A=C.className.match(/\bl_([\w]+)\b/);if(!A){return }var B=clickHandlers[A[1]];if(!B){return }B($(C));return true}var mouseoverHandlers={};var mouseoutHandlers={};var userpopup={cache:{},counter:0,uid:null,mouseover:function(A){if($(A).attr("uid")==this.uid){this.counter++}else{this.hide();this.timeout=setTimeout(function(){userpopup.timeout=null;userpopup.counter++;userpopup.show(A)},100)}},mouseout:function(){var B=$("#userpopup");if(B.css("visibility")!="visible"){this.hide()}else{var A=this.counter;setTimeout(function(){if(userpopup.counter==A){userpopup.hide()}},150)}},show:function(C){var E=$(C);var A=E.attr("uid");var D=E.offset();var B={left:D.left,top:D.top+E.height()};$("body").append('<div id="userpopup" class="l_popup" uid="'+A+'"><div class="userpopup">Loading...</div></div>');$("#userpopup").css(B);this.uid=A;setTimeout(function(){if(A==userpopup.uid){closePopupMenu();$("#userpopup").css("visibility","visible");userpopup.makeShadow()}},600);this.loadPopup(this.uid)},hide:function(){this.counter++;this.uid=null;if(this.timeout){clearTimeout(this.timeout);this.timeout=null}$("#userpopup").remove()},loadPopup:function(A){if(this.cache[A]){$("#userpopup").html(this.cache[A]);return }$.postJSON("/users/popup",{id:A},function(C){if(!C.popup_html){return }userpopup.cache[A]=C.popup_html;var B=$("#userpopup");if(B.length>0&&userpopup.uid==A){B.html($(userpopup.cache[A]));if(B.css("visibility")=="visible"){userpopup.makeShadow()}}})},makeShadow:function(){var B=$("#userpopup");if(B.length==0){return }if(B.find(".shadow").length==0){var D=$('<div class="shadow">');B.append(D)}var C=B.width();var A=B.height();var D=$("#userpopup .shadow");D.width(C-3);D.height(A-3)}};mouseoverHandlers.popup=bind(userpopup,"mouseover");mouseoutHandlers.popup=bind(userpopup,"mouseout");var gShareBreadcrumbs=[];var gShareUrlCache={};var gShareLoadingTimeout=null;var gShareSpinner=null;var gSharePageCounter=0;var gShareHtmlModifier=null;var kShareLoadingSpinnerTime=100;var kShareNumUpdateChecks=14;var kShareUpdateTime=750;clickHandlers.sharetoggle=function(A){$(A).blur();shareToggle()};clickHandlers.shareservices=function(A){$(A).blur();showShareServices()};clickHandlers.shareallservices=function(A){loadShareContentUrl("All services","/share/dialog/services?all=1",null,true);$(A).blur()};clickHandlers.shareconfig=function(B){var A=$(B).attr("servicename");var C=null;var F=$(B).attr("id");if(F){C=F.substr(8)}var E=$(B).attr("servicefullname");if(!E){E=$(B).text()}var D="name="+A;if(C){D+="&id="+C}loadShareContentUrl(E,"/share/dialog/configure?"+D,function(){window.setTimeout(function(){var G=$("#shareconfigdialog input[type='text']");if(G.length==0){return }G[0].focus()},0)},!C)};clickHandlers.sharedelservice=function(A){$.dialog(['<div id="deletewarndialog" class="dialog">','<div class="title">Remove ',htmlEscape(A.attr("service_name")),"</div>",'<div class="content"><form>','<table class="form"><tr><td style="vertical-align:top">','<input type="checkbox" id="alsoremove"> </td><td>Also delete imported entries<br/>(Warning: deleted entries can not be re-imported)','</td></tr></table><div class="buttons">','<input type="button" value="Cancel" onclick="$.closeDialog()"> ','<input type="button" value="Remove" class="save">',"</div></form></div></div>"].join(""),A.offset());$("#deletewarndialog .save").click(function(){var B=$("#alsoremove").get(0).checked;$("#deleteentries").val(B?1:0);$.closeDialog();saveDelService(A.parents("form"));return false})};clickHandlers.shareback=function(A){shareBack();A.blur()};function showShareMainForm(){loadShareContent(gShareMainMessage,gShareMainForm,gShareMainPromo)}function showShareServices(){loadShareContentUrl(gShareImportMessage,"/share/dialog/services",null,true)}function loadShareContent(C,B,A){if(!addBreadcrumb(C,curry(loadShareContent,C,B,A))){return }showShareDialog(B,A)}function loadShareContentUrl(E,C,B,D){if(!addBreadcrumb(E,curry(loadShareContentUrl,E,C,B,D))){return }if(D&&gShareUrlCache[C]){var A=gShareUrlCache[C];showShareDialog(A.lhs_html,A.rhs_html);if(B){B()}return }showShareLoading();var F=gSharePageCounter;$.postJSON(C,{userid:gShareUser},function(G){if(F!=gSharePageCounter){return }if(G){if(D){gShareUrlCache[C]=G}showShareDialog(G.lhs_html,G.rhs_html);if(B){B()}}})}function closeShareDialog(){hideShareLoading();resetBreadcrumbs();updateBreadcrumbs();gShareBreadcrumbs=[];var B=$("#sharedialog .corner.tr");var A=$("#sharedialog .corner.br");B.css("backgroundImage","url('/static/images/r-tr.png?v=1')");A.css("backgroundImage","url('/static/images/r-br.png?v=1')");$("#sharedialog .rhs").css("display","none");$("#sharedialog .body").hide().empty();$("#sharedialog .toggle img").attr("src","/static/images/plus.png?v=2");$("#shareside").show()}function showShareDialog(C,A){gSharePageCounter++;$("#shareside").hide();hideShareLoading();updateBreadcrumbs();$("#sharedialog .toggle img").attr("src","/static/images/minus.png?v=2");C=$(C);if(gShareHtmlModifier){gShareHtmlModifier(C)}if(A){A=$(A);if(gShareHtmlModifier){gShareHtmlModifier(A)}}gShareHtmlModifier=null;var D=$("#sharedialog .corner.tr");var B=$("#sharedialog .corner.br");var E=$("#sharedialog .rhs");if(A){E.css("display","");E.find(".body").html(A).show();D.css("backgroundImage","url('/static/images/r-tr-w.png?v=1')");B.css("backgroundImage","url('/static/images/r-br-w.png?v=1')")}else{E.css("display","none");E.find(".body").empty();D.css("backgroundImage","url('/static/images/r-tr.png?v=1')");B.css("backgroundImage","url('/static/images/r-br.png?v=1')")}$("#sharedialog .lhs .body").html(C).show();showInputHint($("#sharedialog input.shareoptional"),"optional");$("#sharedialog input.sharefocus").focus()}function shareDialogVisible(){return !!$("#sharedialog .lhs .body").html()}function configureService(B){var A=$(B).find("input[type='text']");if(A.length>0){if(!checkRequired(B,[A[0].name])){return false}}return submitConfigureService($(B),"/settings/configureservice",null,function(C){window.setTimeout(function(){var D=$("#service-"+C.serviceid);D.css("background-color","#fff7a1");window.setTimeout(function(){D.css("background-color","white")},1000)},250);getFeedUpdates(C.serviceid,C.servicetime)})}function getFeedUpdates(E,C,B){var F;var A=0;function D(){A++;var G=$.extend({serviceid:E,servicetime:C},window.gFeedArgs);$.postJSON("/events/feed",G,function(I){if(I.updated&&I.feed_html){$("div.noevents").hide();$("#feedcontainer .noevents").remove();var H=$("#feedcontainer .feed");H.html(I.feed_html);addExtraLinks(H);window.clearTimeout(F);if(B){B()}}});if(A<kShareNumUpdateChecks){F=window.setTimeout(D,kShareUpdateTime)}}F=window.setTimeout(D,kShareUpdateTime)}function submitConfigureService(E,D,C,A){var F=E.find("input[type='submit'],input[type='button']");var B=E.find(".error");B.hide();F.attr("disabled","disabled");invalidateShareServices();showShareLoading();var H=gSharePageCounter;var G=E.serializeObj();G.userid=gShareUser;$.postJSON(D,G,function(I){if(H!=gSharePageCounter){return }if(I.error){hideShareLoading();F.attr("disabled","");B.html(I.error);B.show()}else{$("#shareside").empty();if(C){gShareHtmlModifier=curry(C,I)}shareBack();if(A){A(I)}}});return false}function shareBack(){if(gShareBreadcrumbs.length>0){gShareBreadcrumbs.pop()}if(gShareBreadcrumbs.length>0){gShareBreadcrumbs.pop().render()}else{closeShareDialog()}}function updateBreadcrumbs(){var B=$("<span/>");for(var C=0;C<gShareBreadcrumbs.length;C++){if(C>0){B.append('<span style="font-weight:normal">&nbsp;&raquo;&nbsp;</span>')}var A=$('<a href="#"/>');var D=gShareBreadcrumbs[C];A.text(D.title);A.click(breadcrumbClick(C,D.render,gShareBreadcrumbs.length));if(gShareBreadcrumbs.length>1&&C==gShareBreadcrumbs.length-1){A.css("color","#222222");A.css("text-decoration","none")}B.append(A)}$("#sharebreadcrumbs").html(B)}function breadcrumbClick(A,B,C){if(A==0&&C==1){return function(){shareToggle();return false}}return function(D){$(D).blur();gShareBreadcrumbs=gShareBreadcrumbs.slice(0,A);B();return false}}function hideShareLoading(){if(gShareSpinner){gShareSpinner.remove();gShareSpinner=null}if(gShareLoadingTimeout){window.clearTimeout(gShareLoadingTimeout);gShareLoadingTimeout=null}}function showShareLoading(){gShareLoadingTimeout=window.setTimeout(function(){if(!gShareLoadingTimeout){return }gShareLoadingTimeout=null;if(gShareSpinner){gShareSpinner.remove()}var B=$("#sharedialog table");var C=B.offset();var A=B.width();gShareSpinner=$('<div style="position: absolute"><img src="/static/images/loading.gif?v=2"/></div>');gShareSpinner.css("top",C.top+"px");gShareSpinner.css("left",(C.left+A+10)+"px");$(document.body).append(gShareSpinner)},kShareLoadingSpinnerTime)}function resetBreadcrumbs(){if(gShareUser){gShareBreadcrumbs=[{title:gShareImportMessage,render:showShareServices}]}else{gShareBreadcrumbs=[{title:gShareMainMessage,render:showShareMainForm}]}}function addBreadcrumb(C,B){var A=gShareUser?gShareImportMessage:gShareMainMessage;if(gShareBreadcrumbs.length==0&&C!=A){resetBreadcrumbs()}if(gShareBreadcrumbs.length>0&&gShareBreadcrumbs[gShareBreadcrumbs.length-1].title==C){return false}gShareBreadcrumbs.push({title:C,render:B});return true}function submitShare(B){B=$(B);showShareLoading();B.find("input[type='submit']").attr("disabled","disabled");var A=$.extend(B.serializeObj(),gFeedArgs);$.postJSON(B.attr("action"),A,function(D){if(D&&D.feed_html){$("#feedcontainer .noevents").remove();var C=$("#feedcontainer .feed");C.html(D.feed_html);addExtraLinks(C)}hideShareLoading();closeShareDialog()});return false}function invalidateShareServices(){delete gShareUrlCache["/share/dialog/services"];delete gShareUrlCache["/share/dialog/services?all=1"]}function shareToggle(){if(shareDialogVisible()){closeShareDialog()}else{gShareBreadcrumbs=[];if(gShareUser){showShareServices()}else{showShareMainForm()}}}clickHandlers.refreshservice=function(C){var B=C.parents("form");var D=B.find("input.l_sharedelservice").attr("service_name");var A="refresh"+String(Math.random()).substring(2);submitConfigureService(B,"/settings/configureservice?refresh=1",function(F,E){E.find("table").before('<div id="'+A+'" class="infomessage">Refreshing '+htmlEscape(D)+"</div>")},function(E){getFeedUpdates(E.serviceid,E.servicetime,function(){$("#"+A).remove()})})};function saveDelService(A){submitConfigureService(A,"/settings/removeservice",function(C,D){if(D.attr("id")!="shareservices"){return }var F=false;var B=$('<div class="infomessage"/>');B.text(C.service_full_name+" removed - ");var E=$('<a href="#">Undo</a>');B.append(E);E.click(function(){E.blur();if(F){return false}F=true;for(var G in C){if(C[G]==null){delete C[G]}}invalidateShareServices();showShareLoading();var H=gSharePageCounter;$.postJSON("/settings/configureservice",C,function(I){if(H!=gSharePageCounter){return }if(gShareBreadcrumbs.length>0){gShareBreadcrumbs.pop().render()}});return false});D.find("table").before(B)})};
